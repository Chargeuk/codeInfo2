{
    "description": "Execute a plan until it is complete",
    "steps": [
        {
            "type": "llm",
            "label": "Explain Next Coding Work",
            "agentType": "coding_agent",
            "identifier": "coder",
            "messages": [
                {
                    "role": "user",
                    "content": [
                        "Please read Agents.md and follow it's instructions. Give me an overview of the project and where we are up to and how the next steps will be achieved."
                    ]
                }
            ]
        },
        {
            "type": "startLoop",
            "label": "Main loop",
            "steps": [
                {
                    "type": "llm",
                    "label": "Double check plan",
                    "agentType": "coding_agent",
                    "identifier": "coder",
                    "messages": [
                        {
                            "role": "user",
                            "content": [
                                "Please check the last commit AND re-read the next plan to be worked on, even if you have read it before you MUST double check to see if tasks have been added to it or if anything has changed. You must ensure you fully understand the plan and it's remaining tasks before proceeding. You MUST Read the plan and CANNOT assume you understand it from before. You MUST read the whole plan again even if you have read it before. Once you have done this, give me a summary of the remaining work."
                            ]
                        }
                    ]
                },
                {
                    "type": "startLoop",
                    "label": "Execution loop",
                    "steps": [
                        {
                            "type": "llm",
                            "label": "Explain Gotchas",
                            "agentType": "coding_agent",
                            "identifier": "coder",
                            "messages": [
                                {
                                    "role": "user",
                                    "content": [
                                        "Please explain the gotchas a developer would need to watch out for while implementing the next task given all the information within the Description, it's subsections, the AC & Out of scope. Also take into account the implementation information of any previous tasks. If you had asked for clarification about a blocker then ensure you re-read the task as it will have answers for you to proceed within the implementation notes of this task. No matter what, even if you think you know what is in the plan you must re-read at least the next task as it is possible changes have been made since you last read it."
                                    ]
                                }
                            ]
                        },
                        {
                            "type": "llm",
                            "label": "Implement next Task",
                            "agentType": "coding_agent",
                            "identifier": "coder",
                            "messages": [
                                {
                                    "role": "user",
                                    "content": [
                                        "Taking these gotchas into account, please fully work through the next task yourself, precisely following the steps within the 'Implementation Plan Instructions' section to work through each step. You must keep the subtasks tickbox updated as you work through each subtask to ensure everyone understands what has been done. Then you run through the testing steps, ensuring you keep the subtasks tickbox updated as you work through each testing step. Note that LMStudio is running and available, and locally codex has been logged into and works. Get back to me once all subtasks and testing steps are complete. Get back to me once the task is FULLY complete AND each subtask is marked complete AND each testing step is marked complete, with a concise summary of what changed, the gotchas you came across while working through the task and any commands/output that indicate success. Remember to mark each subtask and testing step as complete immediately after completing it rather than waiting until the end so your progress can be monitored. DO NOT BOTHER ME unless a blocker is hit or the whole task is complete and is marked as such. If a blocker is hit then state the blocker within the implemenmtation notes and another agent will add the required information to the plan to help you move past the blocker. Remember to keep your implementation notes concise and to the point. YOU MUST commit, but not push before finishing this request, no matter what changes you made."
                                    ]
                                }
                            ]
                        },
                        {
                            "type": "llm",
                            "label": "Check if plan is fully implemented and fix niggles",
                            "agentType": "planning_agent",
                            "identifier": "planner",
                            "messages": [
                                {
                                    "role": "user",
                                    "content": [
                                        "A coding agent has been working on implementing the code for this plan. Please check if they have marked all tasks complete. If it looks like they have implemented items but maybe just forgotten to fix any task states then you are expected to correct those states accordingly. They may have written a blocking question in the implementation notes, if so please answer the blocker within the notes and mark it as the answer and update any tasks accordingly based on the questions. Note you must not ask me for clarification of the blockers, YOU MUST make any decisions to the best of your ability and update the task and implementation notes accordingly. If you make changes you MUST commit them, but don't push. If there are still tasks to implement or test then just report back where you feel we are up to."
                                    ]
                                }
                            ]
                        },
                        {
                            "type": "break",
                            "label": "Check for completion",
                            "agentType": "planning_agent",
                            "identifier": "planner",
                            "question": "Re-read the plan that was being worked on and check the last 3 git commits. Is the plan that was being worked on now complete? You MUST re-read the plan and check the last 3 git commits before giving your answer as the plan probably has changes made by other agents since you last looked at it.You must give only a yes or no answer. Reply as JSON {\"answer\":\"yes\"|\"no\"}.",
                            "breakOn": "yes"
                        }
                    ]
                },
                {
                    "type": "llm",
                    "label": "Code review",
                    "agentType": "planning_agent",
                    "identifier": "planner",
                    "messages": [
                        {
                            "role": "user",
                            "content": [
                                "Now that everything has been implemented I want you to perform a full code review of all changes in this branch against the main branch. Please perform a standard review looking for code quality, maintainability, performance, security, and adherence to best practices. Also ensure your review checks that all acceptance criteria have been fully met. If you find issues or areas for improvement, please add tasks to the plan to fix these issues, following the same structure of previous tasks. If you do add tasks, you must effectively re-add a full re-test task that will force a full re-test of the story against the acceptance (the last task before you add more work, if it is needed is likely to be a good baseline to copy) AND commit the plan, but don't push. If everything is ok, then add a section to the end of the plan detailing the changes made and the checks you performed AND commit. No matter what changes you make, you must commit them, but don't push."
                            ]
                        }
                    ]
                },
                {
                    "type": "break",
                    "label": "Check for completion",
                    "agentType": "planning_agent",
                    "identifier": "planner",
                    "question": "Re-read the plan that was being worked on and check the last 3 git commits. Is the plan that was being worked on now complete? You MUST re-read the plan and check the last 3 git commits before giving your answer as the plan probably has changes made by other agents since you last looked at it.You must give only a yes or no answer. Reply as JSON {\"answer\":\"yes\"|\"no\"}.",
                    "breakOn": "yes"
                }
            ]
        }
    ]
}